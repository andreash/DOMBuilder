/**
 * DOMBuilder 2.0.0-alpha1 (modes: dom [default], html, template) - https://github.com/insin/DOMBuilder
 * MIT licensed
 */
(function(h){function m(b,a){for(var e in a)b[e]=a[e];return b}function p(b){return r.call(b)==="[object Array]"}function n(b){return r.call(b)==="[object Function]"}function i(b,a){return!!b&&r.call(b)==="[object Object]"&&f.modes[a].isObject(b)}function k(b){for(var a=0,e=b.length,c;a<e;a++)c=b[a],p(c)&&(e+=c.length-1,s.apply(b,[a,1].concat(c)),a--);return b}function l(b){for(var a={},e=0,c;c=d[e];e++)a[c.toUpperCase()]=o(c,b);return a}function o(b,a){var e=function(){if(arguments.length){var c=
q.call(arguments),e,d=c.length,h=c[0];d===1&&p(h)?c=h:i(h,a||f.mode)?(e=h,c=d==2&&p(c[1])?c[1]:q.call(c,1)):c=q.call(c);return f.createElement(b,e,c,a)}else return f.modes[a||f.mode].createElement(b,{},[])};e.map=function(){var c=q.call(arguments);if(p(c[0]))var e={},d=c[0],c=n(c[1])?c[1]:null;else e=c[0],d=c[1],c=n(c[2])?c[2]:null;return f.map(b,e,d,c,a)};return e}var j=typeof module!=="undefined"&&module.exports,r=Object.prototype.toString,q=Array.prototype.slice,s=Array.prototype.splice,d="a abbr acronym address area b bdo big blockquote body br button caption cite code col colgroup dd del dfn div dl dt em fieldset form frame frameset h1 h2 h3 h4 h5 h6 hr head html i iframe img input ins kbd label legend li link map meta noscript object ol optgroup option p param pre q samp script select small span strong style sub sup table tbody td textarea tfoot th thead title tr tt ul var".split(" "),
f={version:"2.0.0-alpha1",mode:j?"html":null,modes:{},addMode:function(b){if(this.mode===null)this.mode=b.name;this.modes[b.name]=b;this[b.name]=m(l(b.name),b.api)},withMode:function(b,a){var e=this.mode;this.mode=b;try{return a.apply(null,q.call(arguments,2))}finally{this.mode=e}},elements:l(),apply:function(b){b=b||{};m(b,this.elements);return b},createElement:function(b,a,e,c){a=a||{};e=e||[];k(e);c=c||this.mode;return this.modes[c].createElement(b,a,e)},map:function(b,a,e,c,d){for(var h=[],k=
0,j=e.length,l,i;k<j;k++){l=m({},a);if(c!==null){if(i=d?f.withMode(d,c,e[k],l,k):c(e[k],l,k),i===null)continue}else i=e[k];p(i)||(i=[i]);h.push(this.createElement(b,l,i,d))}return h},fragment:function(){var b=function(){var a;a=arguments.length===1&&p(arguments[0])?arguments[0]:q.call(arguments);k(a);return this.modes[this.mode].fragment(a)};b.map=function(a,e){if(!n(e))return f.fragment(a);for(var c=[],b=0,d=a.length,h;b<d;b++)h=e(a[b],b),h!==null&&(c=c.concat(h));return f.fragment(c)};return b}(),
util:{TAG_NAMES:d,extend:m,lookup:function(b){for(var a={},e=0,c=b.length;e<c;e++)a[b[e]]=!0;return a},inheritFrom:function(b,a){function e(){}e.prototype=a.prototype;b.prototype=new e;b.prototype.constructor=b},isArray:p,isFunction:n,isObject:i,isString:function(b){return r.call(b)==="[object String]"},flatten:k}};j?m(module.exports,f):h.DOMBuilder=f})(this);
(function(h){var m=typeof module!=="undefined"&&module.exports,p=m?require("./DOMBuilder"):h.DOMBuilder,n=h.document,i=Object.prototype.hasOwnProperty,h=p.util.addEvent,k=p.util.lookup,l,o,j;if(typeof jQuery!="undefined")l=jQuery.attrFn,m||(o=function(d,f){if(i.call(f,"innerHTML")){var b=f.innerHTML;delete f.innerHTML;return jQuery("<"+d+">",f).html(b).get(0)}else return jQuery("<"+d+">",f).get(0)},h=function(d,f,b){jQuery("#"+d)[f](b)},j=function(d,f){jQuery(d).html(f)});else if(l=k("blur focus focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup error".split(" ")),
!m){var r=function(){var d=n.createElement("div");d.style.display="none";d.innerHTML='<span style="color:silver;">s<span>';return/silver/.test(d.getElementsByTagName("span")[0].getAttribute("style"))}(),q=/^(?:href|src|style)$/,s={cellspacing:"cellSpacing","class":"className",colspan:"colSpan","for":"htmlFor",frameborder:"frameBorder",maxlength:"maxLength",readonly:"readOnly",rowspan:"rowSpan",tabindex:"tabIndex",usemap:"useMap"};o=function(d,f){var b=n.createElement(d),a,e;i.call(f,"innerHTML")&&
(j(b,f.innerHTML),delete f.innerHTML);for(a in f)if(e=f[a],a=s[a]||a,l[a])b["on"+a]=e;else{var c=q.test(a);(a in b||b[a]!==void 0)&&!c?b[a]=e:!r&&a=="style"?b.style.cssText=""+e:b.setAttribute(a,""+e)}return b};h=function(d,f,b){n.getElementById(d)["on"+f]=b};j=function(d,f){try{d.innerHTML=f}catch(b){var a=n.createElement("div");for(a.innerHTML=f;d.firstChild;)d.removeChild(d.firstChild);for(;a.firstChild;)d.appendChild(a.firstChild)}}}p.addMode({name:"dom",createElement:function(d,f,b){var a=i.call(f,
"innerHTML"),d=o(d,f);if(!a)for(var a=0,f=b.length,e;a<f;a++)(e=b[a])&&e.nodeType?d.appendChild(e):d.appendChild(n.createTextNode(""+e));return d},fragment:function(d){for(var f=n.createDocumentFragment(),b=0,a=d.length,e;b<a;b++)e=d[b],e.nodeType?f.appendChild(e):f.appendChild(n.createTextNode(""+e));return f},isObject:function(d){return!d.nodeType},api:{EVENT_ATTRS:l,createElement:o,addEvent:h,setInnerHTML:j}})})(this);
(function(h){function m(a){this.value=a}function p(a){return a.split("&").join("&amp;").split("<").join("&lt;").split(">").join("&gt;").split('"').join("&quot;").split("'").join("&#39;")}function n(a){if(a instanceof m)return a.value;return p(""+a)}function i(a){this.childNodes=a||[];this._inlineFragments()}function k(a,e,c){i.call(this,c);this.tagName=this.nodeName=a.toLowerCase();this.attributes=e||{};this.xhtml=o.mode=="XHTML"}function l(a){i.call(this,a)}var o=typeof module!=="undefined"&&module.exports?
require("./DOMBuilder"):h.DOMBuilder,j=o.dom,r=Object.prototype.hasOwnProperty,q=Array.prototype.splice,s=o.util.extend,h=o.util.inheritFrom,d=o.util.lookup,f=d(o.util.TAG_NAMES),b=d("area base br col frame hr input img link meta param".split(" "));h(m,String);m.prototype.toString=m.prototype.valueOf=function(){return this.value};h(i,Object);i.prototype._inlineFragments=function(){for(var a=0,e=this.childNodes.length,c;a<e;a++)if(c=this.childNodes[a],c instanceof l)q.apply(this.childNodes,[a,1].concat(c.childNodes)),
c.childNodes=[]};i.prototype.appendChild=function(a){a instanceof l?(this.childNodes=this.childNodes.concat(a.childNodes),a.childNodes=[]):this.childNodes.push(a)};i.prototype.cloneNode=function(a){var e=this._clone();if(a===!0)for(var c=0,b=this.childNodes.length,d;c<b;c++)d=this.childNodes[c],d instanceof k?e.childNodes.push(d.cloneNode(a)):e.childNodes.push(d);return e};i.prototype._clone=function(){return new Node};h(k,i);k.eventTrackerId=1;k.prototype.nodeType=1;k.prototype._clone=function(){var a=
new k(this.tagName,s({},this.attributes));a.xhtml=this.xhtml;return a};k.prototype.toString=function(a){var a=a||!1,e=f[this.tagName]?this.tagName:n(this.tagName),c=["<"+e],d;for(d in this.attributes)if(d!=="innerHTML")if(j&&j.EVENT_ATTRS[d]){if(a===!0&&!this.eventsFound)this.eventsFound=!0}else c.push(" "+n(d.toLowerCase())+'="'+n(this.attributes[d])+'"');if(this.eventsFound&&!r.call(this.attributes,"id"))this.id="__DB"+k.eventTrackerId++ +"__",c.push(' id="'+this.id+'"');c.push(">");if(b[e])return this.xhtml&&
c.splice(c.length-1,1," />"),c.join("");if(r.call(this.attributes,"innerHTML"))c.push(this.attributes.innerHTML);else{d=0;for(var h=this.childNodes.length,i;d<h;d++)i=this.childNodes[d],i instanceof k||i instanceof m?c.push(i.toString(a)):c.push(p(""+i))}c.push("</"+e+">");return c.join("")};k.prototype.addEvents=function(){if(this.eventsFound){var a=r.call(this.attributes,"id")?n(this.attributes.id):this.id,b;for(b in this.attributes)j.EVENT_ATTRS[b]&&j.addEvent(a,b,this.attributes[b]);delete this.eventsFound;
delete this.id}a=0;b=this.childNodes.length;for(var c;a<b;a++)c=this.childNodes[a],c instanceof k&&c.addEvents()};k.prototype.insertWithEvents=function(a){j.setInnerHTML(a,this.toString(!0));this.addEvents()};h(l,i);l.prototype._clone=function(){return new l};l.prototype.nodeType=11;l.prototype.nodeName="#document-fragment";l.prototype.toString=function(a){for(var a=a||!1,b=[],c=0,d=this.childNodes.length,f;c<d;c++)f=this.childNodes[c],f instanceof k||f instanceof m?b.push(f.toString(a)):b.push(p(""+
f));return b.join("")};l.prototype.addEvents=function(){for(var a=0,b=this.childNodes.length,d;a<b;a++)d=this.childNodes[a],d instanceof k&&d.addEvents()};l.prototype.insertWithEvents=function(a){j.setInnerHTML(a,this.toString(!0));this.addEvents()};o.addMode({name:"html",createElement:function(a,b,d){return new k(a,b,d)},fragment:function(a){return new l(a)},isObject:function(a){return!(a instanceof i)&&!(a instanceof m)},api:{conditionalEscape:n,isSafe:function(a){return a instanceof m},markSafe:function(a){return new m(a)},
SafeString:m,HTMLNode:i,HTMLElement:k,HTMLFragment:l}})})(this);
(function(h){function m(g){return g.replace("\\","\\\\").replace('"','\\"')}function p(g,a){for(var b=[],c=0,e=g.length,f;c<e;c++)f=g[c],f instanceof a&&b.push(f),f instanceof d&&typeof f.contents!="undefined"&&b.push.apply(b,p(f.contents,a));return b}function n(){this.message="pop() was called more times than push()"}function i(g){this.message=g}function k(g){this.message=g}function l(g){this.message=g}function o(g){this.expr=g}function j(g){if(!(this instanceof j))return new j(g);this.stack=[g||
{}];this.renderContext=new r}function r(g){this.stack=[g||{}]}function q(){this.blocks={}}function s(g,a){this.name=g.name;this.parent=g.extend||null;this.contents=a;for(var b=p(a,f),c={},e,h=0;e=b[h];h++){if(typeof c[e.name]!="undefined")throw new k("Block with name '"+e.name+"' appears more than once.");c[e.name]=e}this.blocks=c;d.prototype.parseContents.call(this);z[this.name]=this}function d(g){this.contents=g||[];this.contents.length&&this.parseContents()}function f(g,a){this.name=B(g)?g:g.name;
d.call(this,a)}function b(g,a){this.template=g;this.extraContext=a||{}}function a(g,a,b){this.tagName=g;this.attributes=E({},a);this.dynamicAttrs=!1;for(var c in this.attributes)if(g=this.attributes[c],B(g)&&C.test(g)){if(this.attributes[c]=new u(g),!this.dynamicAttrs)this.dynamicAttrs=!0}else if(g instanceof d&&!this.dynamicAttrs)this.dynamicAttrs=!0;d.call(this,b)}function e(g,a){for(var b in g){this.loopVars=b.split(I);this.listVar=new o(g[b]);break}this.emptyContents=a.length&&a[a.length-1]instanceof
c?a.pop().contents:[];d.call(this,a)}function c(g){d.call(this,g)}function x(g,a){this.test=D(g)?g:this._parseExpr(g);this.elseContents=a.length&&a[a.length-1]instanceof A?a.pop().contents:[];d.call(this,a)}function A(g){d.call(this,g)}function u(g){(this.dynamic=C.test(g))?this.func=this._parseExpr(g):this.text=g}function v(g,a){this.values=g;a=E({as:null,silent:!1},a||{});this.variableName=a.as;this.silent=a.silent;this.id="cycle"+v.cycleId++}var t=typeof module!=="undefined"&&module.exports?require("./DOMBuilder"):
h.DOMBuilder,y=Object.prototype.hasOwnProperty,w=Array.prototype.slice,E=t.util.extend,J=t.util.flatten,h=t.util.inheritFrom,K=t.util.isArray,D=t.util.isFunction,B=t.util.isString,F=t.util.lookup,I=/, ?/,C=/{{(.*?)}}/,G=/^\s+|\s+$/g,z={},H=function(){var g={};return function(a,b){b.global||(y.call(g,b.source)||(g[b.source]=RegExp(b.source,"g")),b=g[b.source]);for(var d=[],c,e,f=0;c=b.exec(a);)e=c.index+c[0].length,e>f&&(d.push(a.slice(f,c.index)),c.length>1&&c.index<a.length&&d.push.apply(d,c.slice(1)),
f=e),b.lastIndex===c.index&&b.lastIndex++;d.push(a.slice(f));return d}}();h(n,Error);h(i,Error);h(k,Error);h(l,Error);o.prototype.resolve=o.prototype.render=function(g){var a=this.expr.split("."),b=a.shift(),c=g.get(b);if(g.hasKey(b))D(c)&&(c=c());else throw new i("Could not find ["+b+"] in "+g);if(a.length)for(var g=a.length,d=0;d<g;d++){b=a[d];if(c===null||c===void 0||typeof c[b]=="undefined")throw new i("Could not find ["+b+"] in "+c);b=c[b];c=D(b)?b.call(c):b}return c};j.prototype.push=function(g){this.stack.push(g||
{})};j.prototype.pop=function(){if(this.stack.length==1)throw new n;return this.stack.pop()};j.prototype.set=function(g,a){this.stack[this.stack.length-1][g]=a};j.prototype.zip=function(g,a){for(var b=this.stack[this.stack.length-1],c=Math.min(g.length,a.length),d=0;d<c;d++)b[g[d]]=a[d]};j.prototype.get=function(g,a){for(var b=this.stack.length-1;b>=0;b--)if(y.call(this.stack[b],g))return this.stack[b][g];return a!==void 0?a:null};j.prototype.hasKey=function(g){for(var a=0,b=this.stack.length;a<b;a++)if(y.call(this.stack[a],
g))return!0;return!1};j.prototype.render=function(g){for(var a=[],b=0,c=g.length;b<c;b++)B(g[b])?a.push(g[b]):a.push(g[b].render(this));return a};h(r,j);r.prototype.get=function(a,b){var c=this.stack[this.stack.length-1];if(y.call(c,a))return c[a];return b!==void 0?b:null};r.prototype.hasKey=function(a){return y.call(this.stack[this.stack.length-1],a)};q.prototype.addBlocks=function(a){for(var b in a)typeof this.blocks[b]!="undefined"?this.blocks[b].unshift(a[b]):this.blocks[b]=[a[b]]};q.prototype.push=
function(a,b){this.blocks[a].push(b)};q.prototype.pop=function(a){if(typeof this.blocks[a]!="undefined"&&this.blocks[a].length)return this.blocks[a].pop();return null};q.prototype.getBlock=function(a){if(typeof this.blocks[a]!="undefined"&&(a=this.blocks[a],a.length))return a[a.length-1];return null};s.prototype.render=function(a){a.renderContext.push();try{return this._render(a)}finally{a.renderContext.pop()}};s.prototype._render=function(a){a.renderContext.hasKey("blockContext")||a.renderContext.set("blockContext",
new q);a.renderContext.get("blockContext").addBlocks(this.blocks);if(this.parent){if(typeof z[this.parent]=="undefined")throw new l("Could not find template named '"+this.parent+'"');return z[this.parent]._render(a)}else return t.fragment(a.render(this.contents))};d.prototype.parseContents=function(){for(var a=0,b=this.contents.length,c;a<b;a++)c=this.contents[a],B(c)&&C.test(c)&&(this.contents[a]=new u(c))};h(f,d);f.prototype.render=function(a){var b=a.renderContext.get("blockContext"),c,d;a.push();
b===null?(a.set("block",this),c=a.render(this.contents)):(d=c=b.pop(this.name),c===null&&(c=this),c=new f(c.name,c.contents),c.context=a,a.set("block",c),c=a.render(c.contents),d!==null&&b.push(this.name,d));a.pop();return c};f.prototype["super"]=function(){var a=this.context.renderContext;if(a.hasKey("blockContext")&&a.get("blockContext").getBlock(this.name)!==null)return this.render(this.context);return""};h(b,d);b.prototype.render=function(a){if(typeof z[this.template]=="undefined")throw new l("Could not find template named '"+
this.template+'"');a.push(this.extraContext);var b=z[this.template].render(a);a.pop();return b};h(a,d);a.prototype.render=function(a){return t.createElement(this.tagName,this.dynamicAttrs?this.renderAttributes(a):this.attributes,a.render(this.contents))};a.prototype.renderAttributes=function(a){var b={},c,e;for(c in this.attributes)e=this.attributes[c],e instanceof d&&(e=e.render(a),K(e)&&(e=J(e).join(""))),b[c]=e;return b};h(e,d);e.prototype.render=function(a){var b=this.listVar.resolve(a),c=[],
d={parentloop:a.get("forloop",{})},e=b.length,f;if(b.length<1)return a.render(this.emptyContents);a.push();a.set("forloop",d);for(var h=0;h<e;h++)f=b[h],this.loopVars.length===1?a.set(this.loopVars[0],f):a.zip(this.loopVars,f),d.counter=h+1,d.counter0=h,d.revcounter=e-h,d.revcounter0=e-h-1,d.first=h===0,d.last=h===e-1,c.push.apply(c,a.render(this.contents));a.pop();return c};h(c,d);c.prototype.render=function(){return[]};h(x,d);x.prototype._parseExpr=function(){var a=F("( ) && || == === <= < >= > != !== !! !".split(" ")),
b=/(\(|\)|&&|\|\||={2,3}|<=|<|>=|>|!={1,2}|!{1,2})/,c=/^-?(?:\d+(?:\.\d+)?|(?:\d+)?\.\d+)$/,d=F(['"',"'"]),e=function(a){var b=a.charAt(0);return a.length>1&&typeof d[b]!="undefined"&&a.lastIndexOf(b)==a.length-1};return function(d){for(var f=["return ("],h=H(d,b),i=0,l=h.length,j;i<l;i++)j=h[i],typeof a[j]!="undefined"?f.push(j):(j=j.replace(G,""))&&(c.test(j)||e(j)?f.push(j):f.push('new Variable("'+m(j)+'").resolve(c)'));f.push(");");try{var n=new Function("c","Variable",f.join(" "));return function(a){return n(a,
o)}}catch(p){throw new k("Invalid $if expression ("+p.message+"): "+d);}}}();x.prototype.render=function(a){return this.test(a)?a.render(this.contents):a.render(this.elseContents)};h(A,d);A.prototype.render=function(){return[]};h(u,d);u.prototype._parseExpr=function(a){for(var b=["var a = []"],a=H(a,C),c=0,d=a.length,e;c<d;c++)e=a[c],c%2?b.push('a.push(new Variable("'+m(e.replace(G,""))+'").resolve(c))'):e&&b.push('a.push("'+m(e)+'")');b.push("return a");var f=new Function("c","Variable",b.join(";"));
return function(a){return f(a,o)}};u.prototype.render=function(a){return this.dynamic?this.func(a):this.text};h(v,d);v.cycleId=1;v.prototype.render=function(a){var b=a.renderContext.get(this.id,0),c=this.values[b];a.renderContext.set(this.id,(b+1)%this.values.length);c instanceof o&&(c=c.resolve(a));this.variableName&&a.set(this.variableName,c);if(this.silent)return[];return c};t.addMode({name:"template",createElement:function(b,c,d){return new a(b,c,d)},fragment:function(a){return a},isObject:function(a){return!(a instanceof
d)},api:{ContextPopError:n,VariableNotFoundError:i,TemplateSyntaxError:k,TemplateNotFoundError:l,Variable:o,Context:j,RenderContext:r,BlockContext:q,Template:s,TemplateNode:d,BlockNode:f,IncludeNode:b,ElementNode:a,ForNode:e,IfNode:x,TextNode:u,CycleNode:v,$template:function(a){return new s(a,w.call(arguments,1))},$block:function(a){return new f(a,w.call(arguments,1))},$include:function(a,c){return new b(a,c)},$var:function(a){return new o(a)},$text:function(a){return new u(a)},$for:function(a){return new e(a,
w.call(arguments,1))},$empty:function(){return new c(w.call(arguments))},$if:function(a){return new x(a,w.call(arguments,1))},$else:function(){return new A(w.call(arguments))},$cycle:function(a,b){return new v(a,b)}}})})(this);
